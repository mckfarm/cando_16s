### ---------
# WSSC Initial 16s rRNA sequence analysis - MiDAS taxonomy assignments
# McKenna Farmer
### packages and working directory ---------
setwd("~/Github/cando_16s/v4v5/")
library(qiime2R)
library(phyloseq)
library(ggplot2)
library(tidyverse)
library(cowplot)
library(lubridate)
library(MetBrewer)
library(ggcorrplot)
### data import -----------
physeq <- qza_to_phyloseq(
features="qiime/rarefied_table.qza",
tree="qiime/rooted_tree.qza",
taxonomy="qiime/taxonomy_midas.qza",
metadata = "qiime/mar01_metadata.txt"
)
### summary stats ----------
# cleaning - remove mitochondria and chloroplasts
physeq <- subset_taxa(physeq, !Genus=="Mitochondria" & !Genus=="Chloroplast")
# relative abundance
rel <- transform_sample_counts(physeq, function(x) x*100/sum(x))
write.csv(rel@tax_table,"all_tax.csv")
topN <- 20
rel_10_names <- sort(taxa_sums(rel), decreasing=TRUE)[1:topN]
rel_10 <- prune_taxa(names(rel_10_names), rel)
### ---------
# WSSC Initial 16s rRNA sequence analysis - MiDAS taxonomy assignments
# McKenna Farmer
### packages and working directory ---------
setwd("~/Github/cando_16s/v4v5/")
library(qiime2R)
library(phyloseq)
library(ggplot2)
library(tidyverse)
library(cowplot)
library(lubridate)
library(MetBrewer)
library(ggcorrplot)
### data import -----------
physeq <- qza_to_phyloseq(
features="qiime/rarefied_table.qza",
tree="qiime/rooted_tree.qza",
taxonomy="qiime/taxonomy_midas.qza",
metadata = "qiime/mar01_metadata.txt"
)
### summary stats ----------
# cleaning - remove mitochondria and chloroplasts
physeq <- subset_taxa(physeq, !Genus=="Mitochondria" & !Genus=="Chloroplast")
# relative abundance
rel <- transform_sample_counts(physeq, function(x) x*100/sum(x))
write.csv(rel@tax_table,"all_tax.csv")
topN <- 20
rel_10_names <- sort(taxa_sums(rel), decreasing=TRUE)[1:topN]
rel_10 <- prune_taxa(names(rel_10_names), rel)
# specific genus of interest
## nitrifiers, PAOs/GAOs
rel_nit <- subset_taxa(rel,Genus=="Nitrotoga" |
Genus=="Nitrospira" |
Genus=="Nitrobacter" |
Genus=="Nitrosomonas" |
Genus=="Nitrosospira")
rel_phos <- subset_taxa(rel,Genus=="Ca_Accumulibacter" |
Genus=="Tetrasphaera" |
Genus=="Ca_Obscuribacter" |
Genus=="Dechloromonas" |
Genus=="Halomonas" |
Genus=="Microlunatus" |
Genus=="Ca_Competibacter" |
Genus=="Ca_Contendobacter" |
Genus=="Defluviicoccus"|
Genus=="Micropruina"|
Genus=="Propionvibrio")
rel_nit <- tax_glom(rel_nit,"Genus")
rel_phos <- tax_glom(rel_phos,"Genus")
# prep for plotting with ggplot - convert to dataframe format
rel_nit_df <- psmelt(rel_nit)
rel_phos_df <- psmelt(rel_phos)
rel_10_df <- psmelt(rel_10)
# date formatting
rel_nit_df$date <- mdy(rel_nit_df$date)
rel_phos_df$date <- mdy(rel_phos_df$date)
rel_10_df$date <- mdy(rel_10_df$date)
# top 10 abundant genus
ggplot(data=rel_10_df,mapping=aes(x=date,y=Abundance,fill=Genus)) +
geom_bar(stat="identity") +
theme_bw() +
scale_fill_manual(values=met.brewer("Hiroshige", 13)) +
theme(axis.text.x = element_text(angle = 0),legend.text = element_text(face = "italic")) +
scale_x_date(date_labels="%m-%y") +
ylab("Relative Abundance (%)") +
xlab("") +
labs(fill="Genus")
# top 10 abundant genus
ggplot(data=rel_10_df,mapping=aes(x=date,y=Abundance,fill=Genus)) +
geom_bar(stat="identity") +
theme_bw() +
scale_fill_manual(values=met.brewer("Redon", 13)) +
theme(axis.text.x = element_text(angle = 0),legend.text = element_text(face = "italic")) +
scale_x_date(date_labels="%m-%y") +
ylab("Relative Abundance (%)") +
xlab("") +
labs(fill="Genus")
ggsave("top10.tiff",width=3000,height=1700,unit="px")
ggsave("top10.tiff",width=3000,height=1700,unit="px",dpi=400)
ggplot(data=rel_10_df,mapping=aes(x=date,y=Abundance,fill=Genus)) +
geom_bar(stat="identity") +
theme_bw() +
scale_fill_manual(values=met.brewer("Redon", 13)) +
theme(axis.text.x = element_text(angle = 0),legend.text = element_text(face = "italic")) +
scale_x_date(date_breaks = "1 month", date_labels =  "%b %y") +
ylab("Relative Abundance (%)") +
xlab("") +
labs(fill="Genus")
ggsave("top10.tiff",width=3000,height=1700,unit="px",dpi=400)
ggsave("top10.tiff",width=3500,height=1700,unit="px",dpi=400)
ggsave("top10.tiff",width=3500,height=1500,unit="px",dpi=400)
